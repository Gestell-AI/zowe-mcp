000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. SETBAL.
000300 ENVIRONMENT DIVISION.
000400 INPUT-OUTPUT SECTION.
000500 FILE-CONTROL.
000600     SELECT ACCOUNT-FILE ASSIGN TO CUSTFILE
000700         ORGANIZATION IS INDEXED
000800         ACCESS MODE IS DYNAMIC
000900         RECORD KEY IS CUST-KEY
001000         FILE STATUS IS WS-FILE-STATUS.
001100     SELECT ACCOUNT-OUT ASSIGN TO CUSTOUT
001200         ORGANIZATION IS SEQUENTIAL
001300         FILE STATUS IS WS-OUT-STATUS.
001400
001500 DATA DIVISION.
001600 FILE SECTION.
001700 FD  ACCOUNT-FILE
001800     RECORD CONTAINS 200 CHARACTERS.
001900 COPY CUSTCOPY.
002000
002100 FD  ACCOUNT-OUT
002000     RECORDING MODE F
002100     RECORD CONTAINS 600 CHARACTERS.
002200 01  ACCOUNT-OUT-REC         PIC X(600).
002300
002400 WORKING-STORAGE SECTION.
002500 01  WS-FILE-STATUS          PIC XX.
002600 01  WS-OUT-STATUS           PIC XX.
002700 01  WS-RECORD-COUNT         PIC 9(5) VALUE ZERO.
002800 01  WS-UPDATE-COUNT         PIC 9(5) VALUE ZERO.
002900 01  WS-BALANCE-AMOUNT       PIC S9(7)V99 COMP-3 VALUE 10000.00.
003000 01  WS-EOF-FLAG             PIC X VALUE 'N'.
003100
003200 PROCEDURE DIVISION.
003300 MAIN-PROCESS.
003400     PERFORM OPEN-FILES
003500     PERFORM READ-AND-UPDATE UNTIL WS-EOF-FLAG = 'Y'
003600     PERFORM CLOSE-FILES
003700     PERFORM DISPLAY-TOTALS
003800     GOBACK.
003900
004000 OPEN-FILES.
004100     OPEN I-O ACCOUNT-FILE
004200     IF WS-FILE-STATUS NOT = '00'
004300         DISPLAY 'ERROR OPENING ACCOUNT-FILE: ' WS-FILE-STATUS
004400         GOBACK
004500     END-IF
004600     OPEN OUTPUT ACCOUNT-OUT
004700     IF WS-OUT-STATUS NOT = '00'
004800         DISPLAY 'ERROR OPENING ACCOUNT-OUT: ' WS-OUT-STATUS
004900         GOBACK
005000     END-IF.
005100
005200 READ-AND-UPDATE.
005300     READ ACCOUNT-FILE NEXT RECORD
005400         AT END MOVE 'Y' TO WS-EOF-FLAG
005500         NOT AT END
005600             ADD 1 TO WS-RECORD-COUNT
005700             MOVE WS-BALANCE-AMOUNT TO CUST-ACCT-BALANCE
005800             REWRITE CUST-REC
005900             IF WS-FILE-STATUS = '00'
006000                 ADD 1 TO WS-UPDATE-COUNT
006100                 MOVE CUST-REC TO ACCOUNT-OUT-REC
006200                 WRITE ACCOUNT-OUT-REC
006300             ELSE
006400                 DISPLAY 'ERROR REWRITING RECORD: '
006500                         CUST-KEY ' STATUS: ' WS-FILE-STATUS
006600             END-IF
006700     END-READ.
006800
006900 CLOSE-FILES.
007000     CLOSE ACCOUNT-FILE
007100     CLOSE ACCOUNT-OUT.
007200
007300 DISPLAY-TOTALS.
007400     DISPLAY 'BALANCE INITIALIZATION COMPLETE'
007500     DISPLAY 'TOTAL RECORDS PROCESSED: ' WS-RECORD-COUNT
007600     DISPLAY 'ACCOUNT BALANCES UPDATED: ' WS-UPDATE-COUNT
007700     DISPLAY 'STANDARD BALANCE SET TO: $' WS-BALANCE-AMOUNT.